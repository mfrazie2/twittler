<!DOCTYPE html>
<html>
  <head>
    <link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lato:700italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <title>Twittler</title>
  </head>
  <body>
    <header>
      <h1 class="title">Twittler</h1>
      <p class="subtitle">String of conciousness caught in a timeline.</p>
      <ul class='nav-bar'>
        <li><a href='#' class="find_new">Find something new</a></li>
        <li><a href='#' class="followers">Followers</a></li>
        <li><a href='#' class="following">Following</a></li>
        <li><a href='#' class="home">Home</a></li>
      </ul>
      <button class='refresh'>Refresh the Timeline</button>
    </header>
    <section class='timeline'>
      <p>Here's what you've missed!</p>
      <div class="container"></div> 
    </section>
    
    <footer></footer>
    
    <script>

      $(document).ready(function() {
        var $body = $('body');
        //$body.html('');

        /*var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet =  $('<div class="new-tweet"></div>');//$('.new-tweet');
          //var $time = $.now();
          var $user = $('<span class="username"></span>');
          var $message = $('<span class="tweet-text"></span>');
          var $timestamp = $('<p class="timestamp"></p>');
          $user.text('@'+tweet.user+ ': ');
          $message.text(tweet.message);
          $timestamp.text(tweet.created_at);
          $user.appendTo($tweet);
          $message.appendTo($tweet);
          $timestamp.appendTo($tweet);
          $tweet.appendTo($('.timeline'));
          index -= 1;
        } */

        var getNewTweets = function() {
          var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet =  $('<div class="new-tweet"></div>');
          var $user = $('<a href="#" class="username"></a>');
          var $message = $('<p class="tweet-text"></p>');
          var $timestamp = $('<p class="timestamp"></p>');
          $timestamp.text(tweet.created_at.getDate() + '/' + tweet.created_at.getMonth() + '/' + tweet.created_at.getFullYear() + ' ' + tweet.created_at.getHours() + ':' + tweet.created_at.getMinutes());
          $user.text("@"+tweet.user+ ': ');
          $user.data({'name': tweet.user});
          $message.text(tweet.message);
          $user.appendTo($tweet);
          $message.appendTo($tweet);
          $timestamp.appendTo($tweet);
          $tweet.appendTo($('.container'));
          index -= 1;
        }
      };



      $('.refresh').on('click', function() {
        $('.container').html('');
        getNewTweets();
        });
      $('.home').on('click', function() {
        $('.container').html('');
        getNewTweets();
        });
      
      $('.container').on('click', '.username', function() {
        event.preventDefault();
        var clickedName = $(this).data('name');
        //console.log(clickedName);
        $('.container').html('');
        var index = streams.users[clickedName].length - 1;
        while(index >= 0){
          var tweet = streams.users[clickedName][index];
          var $tweet =  $('<div class="new-tweet"></div>');
          var $user = $('<a href="#" class="username"></a>');
          var $message = $('<p class="tweet-text"></p>');
          var $timestamp = $('<p class="timestamp"></p>');
          $timestamp.text(tweet.created_at.getDate() + '/' + tweet.created_at.getMonth() + '/' + tweet.created_at.getFullYear() + ' ' + tweet.created_at.getHours() + ':' + tweet.created_at.getMinutes());
          $user.text("@"+tweet.user+ ': ');
          $user.data({'name': tweet.user});
          $message.text(tweet.message);
          $user.appendTo($tweet);
          $message.appendTo($tweet);
          $timestamp.appendTo($tweet);
          $tweet.appendTo($('.container'));
          index -= 1;
        }
      });


      //setTimeout(getNewTweets, 10000);
      });

    </script>
  </body>
</html>
